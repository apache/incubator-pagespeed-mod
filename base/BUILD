licenses(["notice"])  # Apache 2

load(
    "@envoy//bazel:envoy_build_system.bzl",
    "envoy_package",
)

envoy_package()

cc_library(
    name = "log_shim",
    hdrs = [
        "logging.h",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@glog",
    ],
)

cc_library(
    name = "string_util_shim",
    hdrs = [
    ],
    visibility = ["//visibility:public"],
    deps = ["//pagespeed/kernel/base:pagespeed_base"],
)

genrule(
    name = "create_empty_logging_buildflags",
    outs = ["logging_buildflags.h"],
    cmd = "touch $@",
)

genrule(
    name = "create_empty_debugging_buildflags",
    outs = ["debug/debugging_buildflags.h"],
    cmd = "touch $@",
)

cc_library(
    name = "base",
    srcs = [
        #        "lazy_instance_helpers.cc",
        "debug/debugger.cc",
        "debug/alias.cc",
        "strings/string_util.cc",
        "strings/string16.cc",
        "strings/string_piece.cc",
        "strings/string_util_constants.cc",
        "strings/utf_string_conversions.cc",
        "strings/utf_string_conversion_utils.cc",
        "strings/string_number_conversions.cc",
        "time/time.cc",
        "third_party/nspr/prtime.cc",
        "third_party/icu/icu_utf.cc",
        #"at_exit.cc",
        "strings/stringprintf.cc",
        #"memory/ref_counted.cc",
        #"sequence_checker_impl.cc",
        #"threading/thread_checker_impl.cc",
        #"callback_helpers.cc",
        #"threading/thread_task_runner_handle.cc",
        #"sequenced_task_runner.cc",
        #"task_runner.cc",
        #"location.cc",
        #"threading/sequenced_task_runner_handle.cc",
    ],
    hdrs = [
        #"threading/sequenced_task_runner_handle.h",
        #"hash/hash.h",
        #"containers/span.h",        
        #"containers/checked_iterators.h",
        #"location.h",
        #"task_runner.h",
        #"single_thread_task_runner.h",
        #"sequenced_task_runner.h",
        #"sequenced_task_runner_helpers.h",
        #"threading/thread_task_runner_handle.h",
        "callback_helpers.h",
        "strings/stringprintf.h",
        #"at_exit.h",
        "pending_task.h",
        "callback.h",
        "callback_internal.h",
        "stl_util.h",
        "macros.h",
        "component_export.h",
        "export_template.h",
        #"logging.h",
        "optional.h",
        "compiler_specific.h",
        "base_export.h",
        "callback_forward.h",
        "no_destructor.h",
        #        "lazy_instance.h",
        #        "lazy_instance_helpers.h",
        "sequence_token.h",
        "atomicops.h",
        "atomicops_internals_portable.h",
        "debug/debugger.h",
        "debug/alias.h",
        "debug/leak_annotations.h",
        ":create_empty_logging_buildflags",
        #":create_empty_debugging_buildflags",
        #"logging_buildflags.h",
        "atomic_ref_count.h",
        "immediate_crash.h",
        "scoped_clear_last_error.h",
        "template_util.h",
        "sequence_checker.h",
        "sequence_checker_impl.h",
        "thread_annotations.h",
        "strings/char_traits.h",
        "strings/string_piece_forward.h",
        "strings/string_util.h",
        "strings/string16.h",
        "strings/string_piece.h",
        "strings/string_util_posix.h",
        "strings/utf_string_conversion_utils.h",
        "strings/string_number_conversions.h",
        "strings/utf_string_conversions.h",
        "numerics/safe_conversions.h",
        "numerics/safe_conversions_impl.h",
        "numerics/safe_math.h",
        "numerics/checked_math.h",
        "numerics/checked_math_impl.h",
        "numerics/safe_math_shared_impl.h",
        "numerics/safe_math_clang_gcc_impl.h",
        "numerics/clamped_math.h",
        "numerics/clamped_math_impl.h",
        #"memory/ref_counted.h",
        #"memory/weak_ptr.h",
        #"memory/raw_scoped_refptr_mismatch_checker.h",
        #"memory/scoped_refptr.h",
        #"memory/ptr_util.h",
        "synchronization/lock.h",
        "synchronization/atomic_flag.h",
        "synchronization/lock_impl.h",
        "third_party/icu/icu_utf.h",
        "third_party/dmg_fp/dmg_fp.h",
        "threading/thread_collision_warner.h",
        "threading/thread_checker_impl.h",
        "threading/platform_thread.h",
        "containers/queue.h",
        "containers/stack.h",
        "containers/circular_deque.h",
        "containers/vector_buffer.h",
        "containers/util.h",
        "time/time.h",
        "time/time_override.h",
        "third_party/nspr/prtime.h",
        "third_party/dynamic_annotations/dynamic_annotations.h",
        "bind.h",
        "bind_internal.h",
    ],
    copts = [
        "-std=c++14",
        "-Wno-error=unused-parameter",
        "-Wno-unused-parameter",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "//build",
        "@glog",
        "@icu",
        "@mod_pagespeed//base:log_shim",
    ],
)
